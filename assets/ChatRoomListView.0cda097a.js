import{K as j,a0 as B,a1 as M,E as $,a2 as D,a as u,c as p,d as o,b as f,m as N,j as m,l,J as S,N as R,O as _,G as U,r as Y,o as O,X as V,w as b,v as I,M as q,F as E,e as F,C as H,f as z}from"./index.3adf9de5.js";import{_ as A}from"./CardTitle.af463452.js";import{a as G}from"./apiChat.ee2da9ab.js";const J={class:"flex"},K={class:"flex-1 pl-2"},W={class:"font-bold"},X={class:"h-10 w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},P={class:"text-gray text-xs"},Q={props:{room:{type:Object,required:!0,default:()=>{}}},setup(h){const t=h,a=j(),i=B(),{room:d}=M(a),s=$(),{name:r,message:e,avatar:n,roomId:g,_id:k}=D(t.room),C=c=>S(c).format("YYYY/MM/DD HH:MM"),L=()=>{var c;return console.log("avatar",n),(c=n.value.url)!=null?c:new URL("/TeamWall/assets/user_default.b2fc7dc2.png",self.location)},T=()=>{if(d.value.roomId&&d.value.roomId!==g.value){i.error("\u60A8\u4E00\u6B21\u53EA\u80FD\u8DDF\u4E00\u500B\u4EBA\u804A\u5929");return}if(a.updateRoom({roomId:g,name:r,avatar:n,receiver:k}),console.log("deviceType()",R()),R()!=="desktop"){s.push("/chat-room");return}_.emit("handleRoom",!0)};return(c,te)=>{var v,x,w,y;return u(),p("li",{onClick:T,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-baseline justify-between rounded-lg border-2 border-black bg-white p-4"},[o("div",J,[f(N,{size:"40",imgUrl:L()},null,8,["imgUrl"]),o("div",K,[o("p",W,m(l(r)),1),o("p",X,m((x=(v=l(e))==null?void 0:v[0])==null?void 0:x.message),1)])]),o("span",P,m(C((y=(w=l(e))==null?void 0:w[0])==null?void 0:y.createdAt)),1)])}}},Z={class:"text-center"},ee={class:"flex items-center justify-center pt-8"},se=H(" \u8F09\u5165\u4E2D "),ne={setup(h){const t=U([]),a=Y(!0),i=({roomId:s,msg:r})=>{const e=t.findIndex(n=>n.roomId===s);e>-1&&(t[e].message=[r])};_.on("updateChatRecord",i);const d=async()=>{try{a.value=!0;const s=await G.record();console.log("res",s);const{data:{status:r,chatRecord:e}}=s;r&&(Object.assign(t,e),console.log("chatList",t))}catch(s){console.log("error",s)}finally{a.value=!1}};return O(()=>{d()}),V(()=>{_.off("updateChatRecord",i)}),(s,r)=>(u(),p("section",null,[f(A,{title:"\u804A\u5929\u5BA4"}),o("ul",null,[b(o("li",Z," \u7121\u804A\u5929\u8A18\u9304 ",512),[[I,!a.value&&l(t).length===0]]),b(o("li",ee,[se,f(q,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[I,a.value]]),(u(!0),p(E,null,F(l(t),e=>(u(),z(Q,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{ne as default};
