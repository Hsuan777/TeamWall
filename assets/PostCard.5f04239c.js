import{_ as F,a as r,c as d,d as l,r as p,t as b,h as A,i as H,n as k,F as U,e as D,j as C,k as L,b as w,l as M,A as N,u as q,m as W,p as E,f as T,q as $,I as O,s as G,w as J,x as K,y as Q,z as X}from"./index.0ec2fc71.js";import{_ as B}from"./UserInfo.49b3d3e5.js";import{a as Y}from"./apiLike.9027a67b.js";const Z={},ee={class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},se=l("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"},null,-1),te=[se];function ae(o,n){return r(),d("svg",ee,te)}var le=F(Z,[["render",ae]]);const ne={class:"overflow-hidden rounded-lg border-2 border-black"},re=["onClick"],oe=["src"],ue={key:0,class:"absolute top-0 left-0 flex h-full w-full items-center justify-center bg-black bg-opacity-40"},ie={class:"text-3xl text-white"},ce={props:{images:{type:Array,default(){return[]}}},setup(o){const n=o,m=p(!1),h=p(0),e=p(b(n.images).map(u=>u.url));A(n,u=>{e.value=b(u.images).map(x=>x.url)});const v=p(b(n.post));A(n,u=>{v.value=b(u.post)});const g=u=>{h.value=u,m.value=!0},s=()=>{m.value=!1};return(u,x)=>{const P=H("vue-easy-lightbox");return r(),d(U,null,[l("div",ne,[l("div",{class:k(["grid gap-0",{"grid-cols-1":e.value.length<=2,"grid-cols-2":e.value.length==3,"grid-cols-3":e.value.length==4,"max-h-96 grid-flow-col grid-rows-6":e.value.length>=5}])},[(r(!0),d(U,null,D(e.value,(y,i)=>(r(),d(U,{key:y.id},[i<5?(r(),d("div",{key:0,onClick:t=>g(i),class:k(["cursor-pointer",{"col-span-2":e.value.length==3&&i==0,"col-span-3":e.value.length==4&&i==0,"row-span-3":e.value.length>=5&&i<2,"row-span-2":e.value.length>=5&&i>=2,relative:e.value.length>5&&i==4}])},[l("img",{src:y,class:k(["object-center",{"max-h-96":e.value.length==1,"max-h-48":e.value.length==2||e.value.length==3||e.value.length==4}])},null,10,oe),e.value.length>5&&i==4?(r(),d("div",ue,[l("span",ie,C(`+ ${e.value.length-5}`),1)])):L("",!0)],10,re)):L("",!0)],64))),128))],2)]),w(P,{visible:m.value,imgs:e.value,index:h.value,onHide:s},null,8,["visible","imgs","index"])],64)}}},R=M.create({baseURL:`${N}/comment`,timeout:2e4}),de=()=>localStorage.getItem("metaWall")?{headers:{Authorization:localStorage.getItem("metaWall")}}:!1;R.interceptors.response.use(function(o){return o},function(o){const n=o.response.data;return Promise.reject(n)});const me={send:(o,n)=>R.post(`/${o}`,n,de())},ve={class:"rounded-lg border-2 border-black bg-white p-6 shadow-post"},pe={class:"mb-4 whitespace-pre"},ge=["disabled"],he={class:"mb-5 flex items-center"},_e={class:"flex w-full border-2 border-black"},fe=["disabled"],be=l("span",null,"\u7559\u8A00",-1),ke={class:"mb-4 whitespace-pre"},Ie={props:{post:{type:Object,default:()=>{}}},setup(o){const n=o,m=q(),h=W(),e=p(!1),v=p(!1),g=p(""),s=p(b(n.post));A(n,t=>{s.value=b(t.post)});const u=E(()=>s.value.comments.sort((a,_)=>{const f=new Date(a.createdAt),I=new Date(_.createdAt);return f-I})),x=t=>{e.value=!0;const a={posts:t};Y.toggle(a).then(()=>{P(h.user.id),e.value=!1}).catch(()=>{m.error("\u9023\u7DDA\u7570\u5E38\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),e.value=!1})},P=t=>{if(s.value.likes.includes(t)){const _=s.value.likes.findIndex(f=>f===t);s.value.likes.splice(_,1)}else s.value.likes.push(t)},y=t=>{if(g.value.trim()===""){m.error("\u60A8\u5C1A\u672A\u8F38\u5165\u4EFB\u4F55\u8A0A\u606F");return}v.value=!0,me.send(t,{content:g.value}).then(a=>{i(a.data.data),m.success("\u65B0\u589E\u7559\u8A00\u6210\u529F"),g.value="",v.value=!1}).catch(()=>{m.error("\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),v.value=!1})},i=t=>{const a={content:t.content,userId:{_id:t.userId._id,name:t.userId.name,avatar:t.userId.avatar.url},createdAt:t.createdAt};s.value.comments.push(a)};return(t,a)=>{var _,f,I,j,S,V,z;return r(),d("div",ve,[w(B,{class:"mb-4",imgUrl:(f=(_=s.value.userId)==null?void 0:_.avatar)==null?void 0:f.url,name:(I=s.value.userId)==null?void 0:I.name,userPageUrl:`/profile/${(j=s.value.userId)==null?void 0:j._id}`,subTitle:t.$filters.dateTime(s.value.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",pe,C(s.value.content),1),((S=s.value.image)==null?void 0:S.length)>0?(r(),T(ce,{key:0,images:s.value.image},null,8,["images"])):L("",!0),l("div",null,[l("button",{type:"button",class:k(["flex items-center justify-center py-5",{"cursor-not-allowed":e.value}]),onClick:a[0]||(a[0]=c=>x(s.value._id)),disabled:e.value},[(V=s.value.likes)!=null&&V.includes($(h).user.id)?(r(),T(le,{key:1,class:"mr-2 h-5 w-5 text-primary"})):(r(),T(O,{key:0,class:"mr-2 h-5 w-5 text-primary"})),l("span",null,C((z=s.value.likes)==null?void 0:z.length),1)],10,ge)]),l("div",he,[w(G,{class:"mx-2",size:"40",imgUrl:$(h).user.avatar},null,8,["imgUrl"]),l("div",_e,[J(l("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>g.value=c),class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"},null,512),[[K,g.value]]),l("button",{class:k(["flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white",{"cursor-not-allowed bg-slate-500":v.value}]),onClick:a[2]||(a[2]=c=>y(s.value._id)),disabled:v.value},[be,w(Q,{class:k(["ml-1 h-4 w-4 animate-spin",{hidden:!v.value}])},null,8,["class"])],10,fe)])]),(r(!0),d(U,null,D($(u),c=>(r(),d("div",{class:"mb-4 rounded-lg bg-secondary px-4 py-5",key:c._id},[w(B,{class:"mb-4",imgUrl:c.userId.avatar,name:c.userId.name,userPageUrl:`/profile/${c.userId._id}`,subTitle:$(X)(c.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",ke,C(c.content),1)]))),128))])}}};export{Ie as _};
