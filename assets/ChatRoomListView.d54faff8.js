import{a0 as L,a as d,c as p,d as a,b as _,l as n,m as R,j as m,J as k,G as B,r as $,a1 as b,o as j,X as I,w as y,v as C,L as D,F as N,e as S,C as T,f as U}from"./index.5a0da958.js";import{_ as V}from"./CardTitle.19b9dc9f.js";import{u as q,a as F}from"./useChat.45eb5bb3.js";const O={class:"flex items-center"},z={class:"flex-1 pl-3"},A={class:"font-bold"},E={class:"w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},G={class:"text-gray text-xs"},J={props:{room:{type:Object,required:!0,default:()=>{}}},setup(f){const l=f,{handleRoom:t}=q(),{name:r,message:c,avatar:u}=L(l.room),o=e=>e?new Date(e).toLocaleString():"\u5C1A\u672A\u958B\u59CB\u5C0D\u8A71",s=()=>{t(l.room)};return(e,i)=>{var h,g,x,w,v;return d(),p("li",{onClick:s,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-center justify-between rounded-lg border-2 border-black bg-white px-4"},[a("div",O,[_(R,{size:"40",imgUrl:(h=n(u))==null?void 0:h.url},null,8,["imgUrl"]),a("div",z,[a("p",A,m(n(r)),1),a("p",E,m((x=(g=n(c))==null?void 0:g[0])==null?void 0:x.message),1)])]),a("span",G,m(o((v=(w=n(c))==null?void 0:w[0])==null?void 0:v.createdAt)),1)])}}},M={class:"text-center"},X={class:"flex items-center justify-center pt-8"},H=T(" \u8F09\u5165\u4E2D "),W={setup(f){const l=k(),t=B([]),r=$(!0),c=({roomId:o,msg:s})=>{const e=t.findIndex(i=>i.roomId===o);e>-1&&(t[e].message=[s])};b.on("updateChatRecord",c);const u=async()=>{var o;try{r.value=!0;const s=await F.record(),{data:{status:e,chatRecord:i}}=s;e&&(Object.assign(t,i),console.log("chatList",t))}catch(s){const e=(o=s.response.data)==null?void 0:o.message;e&&l.error(e)}finally{r.value=!1}};return j(()=>{u()}),I(()=>{b.off("updateChatRecord",c)}),(o,s)=>(d(),p("section",null,[_(V,{title:"\u804A\u5929\u5BA4"}),a("ul",null,[y(a("li",M," \u7121\u804A\u5929\u8A18\u9304 ",512),[[C,!r.value&&n(t).length===0]]),y(a("li",X,[H,_(D,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[C,r.value]]),(d(!0),p(N,null,S(n(t),e=>(d(),U(J,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{W as default};
