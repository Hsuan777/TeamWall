import{E as _,r as y,G as k,h as x,a as c,c as p,b as $,d as o,w as u,q as H,l as i,n as I,v as m,F as g,e as j,k as C,j as T,H as z}from"./index.3adf9de5.js";import{_ as D}from"./CardTitle.af463452.js";import{a as F}from"./apiPost.96c5c916.js";const N={class:"rounded-lg border-2 border-black bg-white p-8 shadow-post"},S=o("p",null,"\u8CBC\u6587\u5167\u5BB9",-1),L=o("label",{for:"customFileInput",class:"my-4 inline-block cursor-pointer rounded bg-black py-1 px-8 text-white"},"\u4E0A\u50B3\u5716\u7247",-1),V=["accept"],B={class:"text-gray-500"},M=["onClick"],E=["src"],P={class:"text-center"},G={setup(R){const f=_(),l=y(),a={contentLength:1,fileNum:10,fileSize:1024*1024,fileType:["image/jpg","image/jpeg","image/png"]},e=k({content:"",images:[],previews:[],warnHint:[]});x(e.warnHint,()=>{setTimeout(function(){e.warnHint.length=0},3e3)});const d={content(){return e.content.trim().length<a.contentLength?[`\u5167\u5BB9\u81F3\u5C11\u9700\u8981\u8F38\u5165 ${a.contentLength} \u500B\u5B57`]:null},file(s){const t=[];if(s.size>a.fileSize&&t.push(`${s.name}\uFF1A\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u50C5\u9650 ${a.fileSize/(1024*1024)} MB \u4EE5\u4E0B\u6A94\u6848`),a.fileType.indexOf(s.type)<0){const n=a.fileType.map(r=>r.split("/")[1]).join("\u3001");t.push(`${s.name}\uFF1A\u5716\u7247\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650 ${n} \u5716\u7247`)}return t.length>0?t:null}},w=()=>{if(!l.value.files)return;if(l.value.files.length+e.images.length>a.fileNum){e.warnHint.push(`\u4E00\u5247\u8CBC\u6587\u6700\u591A\u53EF\u4EE5\u4E0A\u50B3 ${a.fileNum} \u5F35\u5716\u7247`),l.value=null;return}const s=[];for(const t of l.value.files){const n=d.file(t);if(n)s.push(...n);else{const r=new FileReader;r.onload=h=>{e.previews.push(h.target.result)},r.readAsDataURL(t),e.images.push(t)}}l.value=null,s.length>0&&(e.warnHint=s)},v=s=>{e.previews.splice(s,1),e.images.splice(s,1)},b=()=>{const s=d.content();if(s){e.warnHint.push(s);return}const t=new FormData;t.append("content",e.content),e.images.forEach(n=>{t.append("photos",n)}),F.upload(t).then(n=>{const r=n.data.data.userId;r?f.push(`/profile/${r}`):alert("\u65B0\u589E\u5931\u6557, \u8ACB\u6D3D\u7BA1\u7406\u54E1")}).catch(()=>{alert("\u65B0\u589E\u5931\u6557, \u8ACB\u6D3D\u7BA1\u7406\u54E1")})};return(s,t)=>(c(),p(g,null,[$(D,{title:"\u5F35\u8CBC\u52D5\u614B"}),o("div",N,[S,u(o("textarea",{rows:"10",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9",class:"mt-1 w-full resize-none border-2 px-4 py-3 focus:border-primary focus:shadow-transparent","onUpdate:modelValue":t[0]||(t[0]=n=>i(e).content=n)},null,512),[[H,i(e).content]]),L,o("input",{id:"customFileInput",ref_key:"uploadImages",ref:l,type:"file",accept:a.fileType.join(", "),class:"hidden",onChange:w,multiple:""},null,40,V),o("div",{class:I([{"items-center justify-center py-4":i(e).previews.length===0,"grid-cols-2":i(e).previews.length>1},"mb-4 grid w-full overflow-hidden rounded-lg border-2 border-black"])},[u(o("span",B," \u5C1A\u672A\u4E0A\u50B3\u5716\u7247 ",512),[[m,i(e).previews.length===0]]),i(e).previews.length>0?(c(!0),p(g,{key:0},j(i(e).previews,(n,r)=>(c(),p("div",{class:"relative aspect-video hover:brightness-110",key:r},[o("span",{onClick:h=>v(r),class:"absolute top-1 right-1 cursor-pointer rounded-md bg-white px-2 opacity-50 hover:opacity-100"}," \u79FB\u9664 ",8,M),o("img",{src:n},null,8,E)]))),128)):C("",!0)],2),o("div",P,[u(o("div",{class:"mb-4 whitespace-pre-wrap text-sm text-alert"},T(i(e).warnHint.join(`
`)),513),[[m,i(e).warnHint.length>0]]),o("button",{class:"rounded-lg border-2 border-black bg-subtitle py-3 px-32 font-semibold hover:bg-warning hover:text-black hover:shadow-btn",onClick:t[1]||(t[1]=z(n=>b(),["prevent"]))}," \u9001\u51FA\u8CBC\u6587 ")])])],64))}};export{G as default};
