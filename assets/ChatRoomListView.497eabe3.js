import{H as $,Z as C,$ as D,G as M,a0 as j,a as u,c as p,d as o,b as f,l as S,t as m,k as l,a1 as U,L as R,M as _,D as V,r as Y,o as H,V as N,w as b,v as k,K as q,F,e as O,B as z,f as A}from"./index.03b71b0b.js";import{_ as E}from"./CardTitle.8afdd698.js";import{a as G}from"./apiChat.1a9b6be9.js";const K={class:"flex"},W={class:"flex-1 pl-2"},Z={class:"font-bold"},J={class:"h-10 w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},P={class:"text-gray text-xs"},Q={props:{room:{type:Object,required:!0,default:()=>{}}},setup(h){const s=h,a=$(),i=C(),{room:d}=D(a),t=M(),{name:r,message:e,avatar:n,roomId:g,_id:I}=j(s.room),L=c=>U(c).format("YYYY/MM/DD HH:MM"),B=()=>{var c;return console.log("avatar",n),(c=n.value.url)!=null?c:new URL("/TeamWall/assets/user_default.b2fc7dc2.png",self.location)},T=()=>{if(d.value.roomId&&d.value.roomId!==g.value){i.error("\u60A8\u4E00\u6B21\u53EA\u80FD\u8DDF\u4E00\u500B\u4EBA\u804A\u5929");return}if(a.updateRoom({roomId:g,name:r,avatar:n,receiver:I}),console.log("deviceType()",R()),R()!=="desktop"){t.push("/chat-room");return}_.emit("handleRoom",!0)};return(c,se)=>{var v,x,w,y;return u(),p("li",{onClick:T,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-baseline justify-between rounded-lg border-2 border-black bg-white p-4"},[o("div",K,[f(S,{size:"40",imgUrl:B()},null,8,["imgUrl"]),o("div",W,[o("p",Z,m(l(r)),1),o("p",J,m((x=(v=l(e))==null?void 0:v[0])==null?void 0:x.message),1)])]),o("span",P,m(L((y=(w=l(e))==null?void 0:w[0])==null?void 0:y.createdAt)),1)])}}},X={class:"text-center"},ee={class:"flex items-center justify-center pt-8"},te=z(" \u8F09\u5165\u4E2D "),ne={setup(h){const s=V([]),a=Y(!0),i=({roomId:t,msg:r})=>{const e=s.findIndex(n=>n.roomId===t);e>-1&&(s[e].message=[r])};_.on("updateChatRecord",i);const d=async()=>{try{a.value=!0;const t=await G.record();console.log("res",t);const{data:{status:r,chatRecord:e}}=t;r&&(Object.assign(s,e),console.log("chatList",s))}catch(t){console.log("error",t)}finally{a.value=!1}};return H(()=>{d()}),N(()=>{_.off("updateChatRecord",i)}),(t,r)=>(u(),p("section",null,[f(E,{title:"\u804A\u5929\u5BA4"}),o("ul",null,[b(o("li",X," \u7121\u804A\u5929\u8A18\u9304 ",512),[[k,!a.value&&l(s).length===0]]),b(o("li",ee,[te,f(q,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[k,a.value]]),(u(!0),p(F,null,O(l(s),e=>(u(),A(Q,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{ne as default};
