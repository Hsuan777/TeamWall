import{J as $,$ as j,a0 as B,H as M,a1 as D,a as u,c as p,d as o,b as f,m as N,j as m,l,a2 as S,M as R,N as _,E as U,r as Y,o as H,W as V,w as b,v as I,L as q,F as E,e as F,C as O,f as W}from"./index.a0870418.js";import{_ as z}from"./CardTitle.b2e7f8bb.js";import{a as A}from"./apiChat.f08674fb.js";const J={class:"flex"},G={class:"flex-1 pl-2"},K={class:"font-bold"},P={class:"h-10 w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},Q={class:"text-gray text-xs"},X={props:{room:{type:Object,required:!0,default:()=>{}}},setup(h){const t=h,a=$(),i=j(),{room:d}=B(a),s=M(),{name:r,message:e,avatar:n,roomId:g,_id:L}=D(t.room),k=c=>S(c).format("YYYY/MM/DD HH:MM"),C=()=>{var c;return console.log("avatar",n),(c=n.value.url)!=null?c:new URL("/TeamWall/assets/user_default.b2fc7dc2.png",self.location)},T=()=>{if(d.value.roomId&&d.value.roomId!==g.value){i.error("\u60A8\u4E00\u6B21\u53EA\u80FD\u8DDF\u4E00\u500B\u4EBA\u804A\u5929");return}if(a.updateRoom({roomId:g,name:r,avatar:n,receiver:L}),console.log("deviceType()",R()),R()!=="desktop"){s.push("/chat-room");return}_.emit("handleRoom",!0)};return(c,te)=>{var v,x,w,y;return u(),p("li",{onClick:T,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-baseline justify-between rounded-lg border-2 border-black bg-white p-4"},[o("div",J,[f(N,{size:"40",imgUrl:C()},null,8,["imgUrl"]),o("div",G,[o("p",K,m(l(r)),1),o("p",P,m((x=(v=l(e))==null?void 0:v[0])==null?void 0:x.message),1)])]),o("span",Q,m(k((y=(w=l(e))==null?void 0:w[0])==null?void 0:y.createdAt)),1)])}}},Z={class:"text-center"},ee={class:"flex items-center justify-center pt-8"},se=O(" \u8F09\u5165\u4E2D "),ne={setup(h){const t=U([]),a=Y(!0),i=({roomId:s,msg:r})=>{const e=t.findIndex(n=>n.roomId===s);e>-1&&(t[e].message=[r])};_.on("updateChatRecord",i);const d=async()=>{try{a.value=!0;const s=await A.record();console.log("res",s);const{data:{status:r,chatRecord:e}}=s;r&&(Object.assign(t,e),console.log("chatList",t))}catch(s){console.log("error",s)}finally{a.value=!1}};return H(()=>{d()}),V(()=>{_.off("updateChatRecord",i)}),(s,r)=>(u(),p("section",null,[f(z,{title:"\u804A\u5929\u5BA4"}),o("ul",null,[b(o("li",Z," \u7121\u804A\u5929\u8A18\u9304 ",512),[[I,!a.value&&l(t).length===0]]),b(o("li",ee,[se,f(q,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[I,a.value]]),(u(!0),p(E,null,F(l(t),e=>(u(),W(X,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{ne as default};
