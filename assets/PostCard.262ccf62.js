import{_ as R,a as r,c,d as l,r as m,t as _,h as T,i as F,n as f,F as I,e as B,j as $,k as A,b,l as H,A as M,u as N,m as q,p as W,f as P,q as y,I as E,s as O,w as G,x as J,y as K,z as Q}from"./index.e4e4b507.js";import{_ as z}from"./UserInfo.76a50491.js";import{a as X}from"./apiLike.f73f3359.js";const Y={},Z={class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},ee=l("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"},null,-1),se=[ee];function te(o,n){return r(),c("svg",Z,se)}var ae=R(Y,[["render",te]]);const le={class:"overflow-hidden rounded-lg border-2 border-black"},ne=["onClick"],re=["src"],oe={key:0,class:"absolute top-0 left-0 flex h-full w-full items-center justify-center bg-black bg-opacity-40"},ue={class:"text-3xl text-white"},ie={props:{images:{type:Array,default(){return[]}}},setup(o){const n=o,d=m(!1),v=m(0),e=m(_(n.images).map(u=>u.url));T(n,u=>{e.value=_(u.images).map(k=>k.url)});const p=m(_(n.post));T(n,u=>{p.value=_(u.post)});const t=u=>{v.value=u,d.value=!0},U=()=>{d.value=!1};return(u,k)=>{const C=F("vue-easy-lightbox");return r(),c(I,null,[l("div",le,[l("div",{class:f(["grid gap-0",{"grid-cols-1":e.value.length<=2,"grid-cols-2":e.value.length==3,"grid-cols-3":e.value.length==4,"max-h-96 grid-flow-col grid-rows-6":e.value.length>=5}])},[(r(!0),c(I,null,B(e.value,(w,s)=>(r(),c(I,{key:w.id},[s<5?(r(),c("div",{key:0,onClick:a=>t(s),class:f(["cursor-pointer",{"col-span-2":e.value.length==3&&s==0,"col-span-3":e.value.length==4&&s==0,"row-span-3":e.value.length>=5&&s<2,"row-span-2":e.value.length>=5&&s>=2,relative:e.value.length>5&&s==4}])},[l("img",{src:w,class:f(["object-center",{"max-h-96":e.value.length==1,"max-h-48":e.value.length==2||e.value.length==3||e.value.length==4}])},null,10,re),e.value.length>5&&s==4?(r(),c("div",oe,[l("span",ue,$(`+ ${e.value.length-5}`),1)])):A("",!0)],10,ne)):A("",!0)],64))),128))],2)]),b(C,{visible:d.value,imgs:e.value,index:v.value,onHide:U},null,8,["visible","imgs","index"])],64)}}},D=H.create({baseURL:`${M}/comment`,timeout:2e4}),ce=()=>localStorage.getItem("metaWall")?{headers:{Authorization:localStorage.getItem("metaWall")}}:!1;D.interceptors.response.use(function(o){return o},function(o){const n=o.response.data;return Promise.reject(n)});const de={send:(o,n)=>D.post(`/${o}`,n,ce())},me={class:"rounded-lg border-2 border-black bg-white p-6 shadow-post"},ve={class:"mb-4 whitespace-pre"},pe=["disabled"],ge={class:"mb-5 flex items-center"},he={class:"flex w-full border-2 border-black"},_e=["disabled"],fe=l("span",null,"\u7559\u8A00",-1),be={class:"mb-4 whitespace-pre"},ye={props:{post:{type:Object,default:()=>{}}},setup(o){const n=o,d=N(),v=q(),e=m(!1),p=m(""),t=m(_(n.post));T(n,s=>{t.value=_(s.post)});const U=W(()=>t.value.comments.sort((a,g)=>{const h=new Date(a.createdAt),x=new Date(g.createdAt);return h-x})),u=s=>{e.value=!0;const a={posts:s};X.toggle(a).then(()=>{k(v.user.id),e.value=!1}).catch(()=>{d.error("\u9023\u7DDA\u7570\u5E38\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),e.value=!1})},k=s=>{if(t.value.likes.includes(s)){const g=t.value.likes.findIndex(h=>h===s);t.value.likes.splice(g,1)}else t.value.likes.push(s)},C=s=>{if(p.value.trim()===""){d.error("\u60A8\u5C1A\u672A\u8F38\u5165\u4EFB\u4F55\u8A0A\u606F");return}e.value=!0,de.send(s,{content:p.value}).then(a=>{w(a.data.data),d.success("\u65B0\u589E\u7559\u8A00\u6210\u529F"),e.value=!1}).catch(()=>{d.error("\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),e.value=!1})},w=s=>{const a={content:s.content,userId:{_id:s.userId._id,name:s.userId.name,avatar:s.userId.avatar.url},createdAt:s.createdAt};t.value.comments.push(a)};return(s,a)=>{var g,h,x,L,j,S,V;return r(),c("div",me,[b(z,{class:"mb-4",imgUrl:(h=(g=t.value.userId)==null?void 0:g.avatar)==null?void 0:h.url,name:(x=t.value.userId)==null?void 0:x.name,userPageUrl:`/profile/${(L=t.value.userId)==null?void 0:L._id}`,subTitle:s.$filters.dateTime(t.value.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",ve,$(t.value.content),1),((j=t.value.image)==null?void 0:j.length)>0?(r(),P(ie,{key:0,images:t.value.image},null,8,["images"])):A("",!0),l("div",null,[l("button",{type:"button",class:f(["flex items-center justify-center py-5",{"cursor-not-allowed":e.value}]),onClick:a[0]||(a[0]=i=>u(t.value._id)),disabled:e.value},[(S=t.value.likes)!=null&&S.includes(y(v).user.id)?(r(),P(ae,{key:1,class:"mr-2 h-5 w-5 text-primary"})):(r(),P(E,{key:0,class:"mr-2 h-5 w-5 text-primary"})),l("span",null,$((V=t.value.likes)==null?void 0:V.length),1)],10,pe)]),l("div",ge,[b(O,{class:"mx-2",size:"40",imgUrl:y(v).user.avatar},null,8,["imgUrl"]),l("div",he,[G(l("input",{"onUpdate:modelValue":a[1]||(a[1]=i=>p.value=i),class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"},null,512),[[J,p.value]]),l("button",{class:f(["flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white",{"cursor-not-allowed bg-slate-500":e.value}]),onClick:a[2]||(a[2]=i=>C(t.value._id)),disabled:e.value},[fe,b(K,{class:f(["ml-1 h-4 w-4 animate-spin",{hidden:!e.value}])},null,8,["class"])],10,_e)])]),(r(!0),c(I,null,B(y(U),i=>(r(),c("div",{class:"mb-4 rounded-lg bg-secondary px-4 py-5",key:i._id},[b(z,{class:"mb-4",imgUrl:i.userId.avatar,name:i.userId.name,userPageUrl:`/profile/${i.userId._id}`,subTitle:y(Q)(i.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",be,$(i.content),1)]))),128))])}}};export{ye as _};
