import{_ as J,a as u,c as v,d as l,r as c,t as k,h as j,i as K,n as w,F as P,e as W,j as T,k as S,b,l as Q,A as X,u as Y,m as Z,p as ee,f as A,q as C,I as se,s as te,w as U,x as ae,y as H,v as L,z as le}from"./index.b345e2aa.js";import{_ as M}from"./UserInfo.eea6f387.js";import{a as ne}from"./apiLike.b6ec8941.js";const re={},oe={class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},ue=l("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"},null,-1),ie=[ue];function ce(r,o){return u(),v("svg",oe,ie)}var de=J(re,[["render",ce]]);const me={class:"overflow-hidden rounded-lg border-2 border-black"},ve=["onClick"],pe=["src"],ge={key:0,class:"absolute top-0 left-0 flex h-full w-full items-center justify-center bg-black bg-opacity-40"},he={class:"text-3xl text-white"},_e={props:{images:{type:Array,default(){return[]}}},setup(r){const o=r,m=c(!1),h=c(0),e=c(k(o.images).map(n=>n.url));j(o,n=>{e.value=k(n.images).map(p=>p.url)});const x=c(k(o.post));j(o,n=>{x.value=k(n.post)});const g=n=>{h.value=n,m.value=!0},y=()=>{m.value=!1};return(n,p)=>{const s=K("vue-easy-lightbox");return u(),v(P,null,[l("div",me,[l("div",{class:w(["grid gap-0",{"grid-cols-1":e.value.length<=2,"grid-cols-2":e.value.length==3,"grid-cols-3":e.value.length==4,"max-h-96 grid-flow-col grid-rows-6":e.value.length>=5}])},[(u(!0),v(P,null,W(e.value,($,d)=>(u(),v(P,{key:$.id},[d<5?(u(),v("div",{key:0,onClick:z=>g(d),class:w(["cursor-pointer",{"col-span-2":e.value.length==3&&d==0,"col-span-3":e.value.length==4&&d==0,"row-span-3":e.value.length>=5&&d<2,"row-span-2":e.value.length>=5&&d>=2,relative:e.value.length>5&&d==4}])},[l("img",{src:$,class:w(["object-center",{"max-h-96":e.value.length==1,"max-h-48":e.value.length==2||e.value.length==3||e.value.length==4}])},null,10,pe),e.value.length>5&&d==4?(u(),v("div",ge,[l("span",he,T(`+ ${e.value.length-5}`),1)])):S("",!0)],10,ve)):S("",!0)],64))),128))],2)]),b(s,{visible:m.value,imgs:e.value,index:h.value,onHide:y},null,8,["visible","imgs","index"])],64)}}},V=Q.create({baseURL:`${X}/comment`,timeout:2e4}),N=()=>localStorage.getItem("metaWall")?{headers:{Authorization:localStorage.getItem("metaWall")}}:!1;V.interceptors.response.use(function(r){return r},function(r){const o=r.response.data;return Promise.reject(o)});const q={get:r=>V.get(`/${r}`,N()),send:(r,o)=>V.post(`/${r}`,o,N())},fe={class:"rounded-lg border-2 border-black bg-white p-6 shadow-post"},be={class:"mb-4 whitespace-pre"},ke=["disabled"],we={class:"mb-5 flex items-center"},xe={class:"flex w-full border-2 border-black"},ye=["disabled"],$e=l("span",null,"\u7559\u8A00",-1),Ie=l("span",null,"\u67E5\u770B\u7559\u8A00",-1),Ce={class:"mb-4 whitespace-pre"},Ae={props:{post:{type:Object,default:()=>{}}},setup(r){const o=r,m=Y(),h=Z(),e=c(!1),x=c([]),g=c(!1),y=c(!1),n=c(!1),p=c(""),s=c(k(o.post));j(o,t=>{s.value=k(t.post)});const $=t=>{e.value=!0;const a={posts:t};ne.toggle(a).then(()=>{d(h.user.id),e.value=!1}).catch(()=>{m.error("\u9023\u7DDA\u7570\u5E38\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),e.value=!1})},d=t=>{if(s.value.likes.includes(t)){const _=s.value.likes.findIndex(f=>f===t);s.value.likes.splice(_,1)}else s.value.likes.push(t)},z=t=>{g.value||(g.value=!0,q.get(t).then(a=>{x.value=a.data.data,y.value=!0,g.value=!1}).catch(()=>{m.error("\u53D6\u5F97\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),g.value=!1}))},E=t=>{if(p.value.trim()===""){m.error("\u60A8\u5C1A\u672A\u8F38\u5165\u4EFB\u4F55\u8A0A\u606F");return}n.value=!0,q.send(t,{content:p.value}).then(a=>{G(a.data.data),m.success("\u65B0\u589E\u7559\u8A00\u6210\u529F"),p.value="",n.value=!1}).catch(()=>{m.error("\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),n.value=!1})},G=t=>{const a={content:t.content,userId:{_id:t.userId._id,name:t.userId.name,avatar:{url:t.userId.avatar.url}},createdAt:t.createdAt};x.value.push(a)},O=ee(()=>x.value.sort((a,_)=>{const f=new Date(a.createdAt),I=new Date(_.createdAt);return f-I}));return(t,a)=>{var _,f,I,B,D,R,F;return u(),v("div",fe,[b(M,{class:"mb-4",imgUrl:(f=(_=s.value.userId)==null?void 0:_.avatar)==null?void 0:f.url,name:(I=s.value.userId)==null?void 0:I.name,userPageUrl:`/profile/${(B=s.value.userId)==null?void 0:B._id}`,subTitle:t.$filters.dateTime(s.value.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",be,T(s.value.content),1),((D=s.value.image)==null?void 0:D.length)>0?(u(),A(_e,{key:0,images:s.value.image},null,8,["images"])):S("",!0),l("div",null,[l("button",{type:"button",class:w(["flex items-center justify-center py-5",{"cursor-not-allowed":e.value}]),onClick:a[0]||(a[0]=i=>$(s.value._id)),disabled:e.value},[(R=s.value.likes)!=null&&R.includes(C(h).user.id)?(u(),A(de,{key:1,class:"mr-2 h-5 w-5 text-primary"})):(u(),A(se,{key:0,class:"mr-2 h-5 w-5 text-primary"})),l("span",null,T((F=s.value.likes)==null?void 0:F.length),1)],10,ke)]),l("div",we,[b(te,{class:"mx-2",size:"40",imgUrl:C(h).user.avatar},null,8,["imgUrl"]),l("div",xe,[U(l("input",{"onUpdate:modelValue":a[1]||(a[1]=i=>p.value=i),class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"},null,512),[[ae,p.value]]),l("button",{class:w(["flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white",{"cursor-not-allowed bg-slate-500":n.value}]),onClick:a[2]||(a[2]=i=>E(s.value._id)),disabled:n.value},[$e,b(H,{class:w(["ml-1 h-4 w-4 animate-spin",{hidden:!n.value}])},null,8,["class"])],10,ye)])]),U(l("div",{class:"mb-4 inline-flex cursor-pointer items-center font-bold text-primary hover:underline",onClick:a[3]||(a[3]=i=>z(s.value._id))},[Ie,U(b(H,{class:"ml-1 h-4 w-4 animate-spin"},null,512),[[L,g.value]])],512),[[L,s.value.comments.length>0&&!y.value]]),(u(!0),v(P,null,W(C(O),i=>U((u(),v("div",{class:"mb-4 rounded-lg bg-secondary px-4 py-5",key:i._id},[b(M,{class:"mb-4",imgUrl:i.userId.avatar.url,name:i.userId.name,userPageUrl:`/profile/${i.userId._id}`,subTitle:C(le)(i.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",Ce,T(i.content),1)])),[[L,y.value]])),128))])}}};export{Ae as _};
