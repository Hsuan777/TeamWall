import{E as y,r as k,G as x,h as $,a as p,c as u,b as H,d as r,w as d,q as I,l as i,n as j,v as g,F as m,e as C,k as T,j as z,H as D}from"./index.5a0da958.js";import{_ as F}from"./CardTitle.19b9dc9f.js";import{a as N}from"./apiPost.4fefb743.js";const S={class:"rounded-lg border-2 border-black bg-white p-8 shadow-post"},L=r("p",null,"\u8CBC\u6587\u5167\u5BB9",-1),V=r("label",{for:"customFileInput",class:"my-4 inline-block cursor-pointer rounded bg-black py-1 px-8 text-white"},"\u4E0A\u50B3\u5716\u7247",-1),B=["accept"],M={class:"text-gray-500"},E=["onClick"],P=["src"],R={class:"text-center"},O={setup(U){const f=y(),l=k(),a={contentLength:1,fileNum:10,fileSize:1024*1024,fileType:["image/jpg","image/jpeg","image/png"]},e=x({content:"",images:[],previews:[],warnHint:[]});$(e.warnHint,()=>{setTimeout(function(){e.warnHint.length=0},3e3)});const h={content(){return e.content.trim().length<a.contentLength?[`\u5167\u5BB9\u81F3\u5C11\u9700\u8981\u8F38\u5165 ${a.contentLength} \u500B\u5B57`]:null},file(s){const t=[];if(s.size>a.fileSize&&t.push(`${s.name}\uFF1A\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u50C5\u9650 ${a.fileSize/(1024*1024)} MB \u4EE5\u4E0B\u6A94\u6848`),a.fileType.indexOf(s.type)<0){const n=a.fileType.map(o=>o.split("/")[1]).join("\u3001");t.push(`${s.name}\uFF1A\u5716\u7247\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650 ${n} \u5716\u7247`)}return t.length>0?t:null}},v=s=>{if(!l.value.files)return;if(l.value.files.length+e.images.length>a.fileNum){e.warnHint.push(`\u4E00\u5247\u8CBC\u6587\u6700\u591A\u53EF\u4EE5\u4E0A\u50B3 ${a.fileNum} \u5F35\u5716\u7247`),l.value=null,s.target.value=null;return}const t=[];for(const n of l.value.files){const o=h.file(n);if(o)t.push(...o);else{const c=new FileReader;c.onload=_=>{e.previews.push(_.target.result)},c.readAsDataURL(n),e.images.push(n)}}l.value=null,s.target.value=null,t.length>0&&(e.warnHint=t)},w=s=>{e.previews.splice(s,1),e.images.splice(s,1)},b=()=>{const s=h.content();if(s){e.warnHint.push(s);return}const t=new FormData;t.append("content",e.content),e.images.forEach(n=>{t.append("photos",n)}),N.upload(t).then(n=>{const o=n.data.data.userId;o?f.push(`/profile/${o}`):alert("\u65B0\u589E\u5931\u6557, \u8ACB\u6D3D\u7BA1\u7406\u54E1")}).catch(()=>{alert("\u65B0\u589E\u5931\u6557, \u8ACB\u6D3D\u7BA1\u7406\u54E1")})};return(s,t)=>(p(),u(m,null,[H(F,{title:"\u5F35\u8CBC\u52D5\u614B"}),r("div",S,[L,d(r("textarea",{rows:"10",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9",class:"mt-1 w-full resize-none border-2 px-4 py-3 focus:border-primary focus:shadow-transparent","onUpdate:modelValue":t[0]||(t[0]=n=>i(e).content=n)},null,512),[[I,i(e).content]]),V,r("input",{id:"customFileInput",ref_key:"uploadImages",ref:l,type:"file",accept:a.fileType.join(", "),class:"hidden",onChange:v,multiple:""},null,40,B),r("div",{class:j([{"items-center justify-center py-4":i(e).previews.length===0,"grid-cols-2":i(e).previews.length>1},"mb-4 grid w-full overflow-hidden rounded-lg border-2 border-black"])},[d(r("span",M," \u5C1A\u672A\u4E0A\u50B3\u5716\u7247 ",512),[[g,i(e).previews.length===0]]),i(e).previews.length>0?(p(!0),u(m,{key:0},C(i(e).previews,(n,o)=>(p(),u("div",{class:"relative aspect-video hover:brightness-110",key:o},[r("span",{onClick:c=>w(o),class:"absolute top-1 right-1 cursor-pointer rounded-md bg-white px-2 opacity-50 hover:opacity-100"}," \u79FB\u9664 ",8,E),r("img",{src:n},null,8,P)]))),128)):T("",!0)],2),r("div",R,[d(r("div",{class:"mb-4 whitespace-pre-wrap text-sm text-alert"},z(i(e).warnHint.join(`
`)),513),[[g,i(e).warnHint.length>0]]),r("button",{class:"rounded-lg border-2 border-black bg-subtitle py-3 px-32 font-semibold hover:bg-warning hover:text-black hover:shadow-btn",onClick:t[1]||(t[1]=D(n=>b(),["prevent"]))}," \u9001\u51FA\u8CBC\u6587 ")])])],64))}};export{O as default};
