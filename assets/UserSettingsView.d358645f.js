var X=Object.defineProperty;var q=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var A=(b,o,r)=>o in b?X(b,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):b[o]=r,E=(b,o)=>{for(var r in o||(o={}))Y.call(o,r)&&A(b,r,o[r]);if(q)for(var r of q(o))ee.call(o,r)&&A(b,r,o[r]);return b};import{u as se,r as h,G as U,L as j,h as ae,a as p,c as w,b as M,d as s,n as L,H as $,F as R,l as a,f as D,m as T,w as m,v as x,j as k,k as P,q as N,Q as I,M as Z,P as G}from"./index.3adf9de5.js";import{_ as re}from"./CardTitle.af463452.js";import{c as v,r as z,m as te,s as oe,u as H}from"./index.esm.46585c13.js";const le={class:"flex flex-wrap pl-6 text-center text-sm font-medium"},ne={class:"flex flex-col items-center rounded-xl border-2 border-black bg-white p-8 shadow-post"},de=["value"],ie={key:0,class:"mb-4 text-alert"},ue=["onSubmit"],ce={class:"mb-1"},me=s("label",{for:"nickName",class:"mb-1 block"},"\u66B1\u7A31",-1),pe={key:0,class:"font-azeret text-alert"},be={class:"mt-4 mb-8"},fe=s("label",{for:"male",class:"mb-1 block"},"\u6027\u5225",-1),we=s("label",{for:"male",class:"mr-7"},"\u7537\u6027",-1),ve=s("label",{for:"female",class:""},"\u5973\u6027",-1),ge=["disabled"],he=["onSubmit"],ke={class:"mb-1"},ye=s("label",{for:"newPassword",class:"mb-1 block"},"\u8F38\u5165\u65B0\u5BC6\u78BC",-1),xe={key:0,class:"font-azeret text-alert"},_e={class:"mb-1"},$e=s("label",{for:"checkPassword",class:"mb-1 block"},"\u518D\u6B21\u8F38\u5165",-1),Pe={key:1,class:"font-azeret text-alert"},Ce=["disabled"],Se={setup(b){const o=se(),r=h(!1),i=U({profile:"\u9001\u51FA\u66F4\u65B0",password:"\u91CD\u8A2D\u5BC6\u78BC"}),Q=j(()=>({name:{required:v.withMessage("\u66B1\u7A31\u5FC5\u586B",z),minLength:v.withMessage("\u66B1\u7A31\u81F3\u5C11 2 \u500B\u5B57\u5143\u4EE5\u4E0A",te(2))}})),J=j(()=>({password:{required:v.withMessage("\u5BC6\u78BC\u5FC5\u586B",z),alphaNum:v.withMessage("\u5BC6\u78BC\u9700\u81F3\u5C11 8 \u78BC\u4EE5\u4E0A\uFF0C\u4E26\u82F1\u6578\u6DF7\u5408",v.regex(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,/\d/))},passwordConfirm:{required:v.withMessage("\u5BC6\u78BC\u5FC5\u586B",z),sameAsPassword:v.withMessage("\u5BC6\u78BC\u4E0D\u4E00\u81F4",oe(u.password))}})),_=h("editNickName"),S=c=>{_.value=c},l=h(E({},o.user));ae(o,c=>{l.value=c.user});const y=H(Q,l),C=h(null),V=h(null),n=U({base64:"",errorMessage:{size:"\u6A94\u6848\u9700\u5728 2 MB \u4EE5\u5167"},hasError:!1}),K=()=>{const c=C.value.files[0],e=new FormData;r.value=!0,e.append("avatar",c),e.append("name",l.value.name.trim()),e.append("gender",l.value.gender),G.updateProfile(e).then(f=>{f.data.status?(r.value=!1,i.profile="\u66F4\u65B0\u5B8C\u6210",o.updateUser(f.data.data),B(),g()):(r.value=!1,i.profile="\u66F4\u65B0\u5931\u6557",g())}).catch(()=>{r.value=!1,i.profile="\u66F4\u65B0\u5931\u6557",g()})},O=c=>{const e=c.target.files[0];if(e.size>=2*1024*1024)return n.hasError=!0;const f=new FileReader;f.readAsDataURL(e),f.onload=t=>{n.hasError=!1,n.base64=t.target.result}},B=()=>{V.value.reset(),n.base64="",n.hasError=!1},u=U({}),d=H(J,u),F=h(null),W=async c=>{r.value=!0,await G.updatePassword(u).then(e=>{e.data.status?(r.value=!1,i.password="\u66F4\u65B0\u5B8C\u6210",u.password="",u.passwordConfirm="",g()):(r.value=!1,i.password="\u66F4\u65B0\u5931\u6557",g())}).catch(()=>{r.value=!1,i.password="\u66F4\u65B0\u5931\u6557",g()}),c.target.reset(),F.value.click()},g=()=>{setTimeout(()=>{i.profile="\u9001\u51FA\u66F4\u65B0",i.password="\u91CD\u8A2D\u5BC6\u78BC"},3e3)};return(c,e)=>{var f;return p(),w(R,null,[M(re,{title:"\u4FEE\u6539\u500B\u4EBA\u8CC7\u6599"}),s("ul",le,[s("li",null,[s("a",{href:"#",class:L(["inline-block rounded-t-md border-x-2 border-t-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",_.value==="editNickName"?"bg-black text-white":""]),onClick:e[0]||(e[0]=$(t=>S("editNickName"),["prevent"]))}," \u66B1\u7A31\u4FEE\u6539 ",2)]),s("li",null,[s("a",{href:"#",class:L(["inline-block rounded-t-md border-t-2 border-r-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",_.value==="resetPassword"?"bg-black text-white":""]),onClick:e[1]||(e[1]=$(t=>S("resetPassword"),["prevent"]))}," \u91CD\u8A2D\u5BC6\u78BC ",2)])]),s("div",ne,[_.value==="editNickName"?(p(),w(R,{key:0},[a(n).base64?(p(),D(T,{key:0,size:"107",imgUrl:a(n).base64,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])):(p(),D(T,{key:1,size:"107",imgUrl:(f=l.value)==null?void 0:f.avatar,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])),s("form",{ref_key:"avatarForm",ref:V,action:"",class:"text-center"},[s("input",{ref_key:"imageFile",ref:C,type:"file",name:"photos",accept:"image/png, image/jpeg, image/jpg",class:"btn btn-dark mb-4 hidden px-8 py-1",onChange:e[2]||(e[2]=t=>O(t))},null,544),m(s("input",{type:"reset",value:"\u53D6\u6D88",class:"mb-4 mr-4 rounded border border-black bg-white px-10 py-1 text-black",onClick:B},null,512),[[x,a(n).base64]]),s("input",{type:"button",value:a(n).base64===""?"\u4E0A\u50B3\u5927\u982D\u7167":"\u518D\u9078\u4E00\u5F35",class:"mb-4 rounded border border-black bg-black px-6 py-1 text-white",onClick:e[3]||(e[3]=t=>C.value.click())},null,8,de),a(n).hasError?(p(),w("p",ie," Tip: "+k(a(n).errorMessage.size),1)):P("",!0)],512),s("form",{onSubmit:$(K,["prevent"]),action:"",class:""},[s("div",ce,[me,m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.name=t),type:"text",name:"",id:"nickName",placeholder:"\u8ACB\u8F38\u5165\u66B1\u7A31",class:"border-2 border-black",onBlur:e[5]||(e[5]=(...t)=>a(y).name.$touch&&a(y).name.$touch(...t))},null,544),[[N,l.value.name]])]),a(y).name.$errors.length>0?(p(),w("div",pe,k(a(y).name.$errors[0].$message),1)):P("",!0),s("div",be,[fe,m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.gender=t),type:"radio",name:"gender",id:"male",value:"male",class:"mr-3"},null,512),[[I,l.value.gender]]),we,m(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.gender=t),type:"radio",name:"gender",id:"female",value:"female",class:"mr-3"},null,512),[[I,l.value.gender]]),ve]),s("button",{type:"submit",class:"flex w-full items-center justify-center rounded border-2 border-black bg-warning py-4 text-black disabled:opacity-50",disabled:a(y).name.$errors.length>0},[m(s("span",null,k(a(i).profile),513),[[x,!r.value]]),m(M(Z,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,r.value]])],8,ge)],40,ue)],64)):(p(),w("form",{key:1,onSubmit:$(W,["prevent"]),action:"",class:"flex-col items-center"},[s("div",ke,[ye,m(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(u).password=t),type:"password",id:"newPassword",placeholder:"\u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",onBlur:e[9]||(e[9]=(...t)=>a(d).password.$touch&&a(d).password.$touch(...t)),required:""},null,544),[[N,a(u).password]])]),a(d).password.$errors.length>0?(p(),w("div",xe,k(a(d).password.$errors[0].$message),1)):P("",!0),s("div",_e,[$e,m(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>a(u).passwordConfirm=t),type:"password",id:"checkPassword",placeholder:"\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",onBlur:e[11]||(e[11]=(...t)=>a(d).passwordConfirm.$touch&&a(d).passwordConfirm.$touch(...t)),required:""},null,544),[[N,a(u).passwordConfirm]])]),a(d).passwordConfirm.$errors.length>0?(p(),w("div",Pe,k(a(d).passwordConfirm.$errors[0].$message),1)):P("",!0),s("button",{type:"submit",class:"mt-8 flex w-full items-center justify-center rounded border-2 border-black bg-subtitle py-4 text-black disabled:opacity-50",disabled:a(d).password.$errors.length>0||a(d).passwordConfirm.$errors.length>0||a(u).password===void 0},[m(s("span",null,k(a(i).password),513),[[x,!r.value]]),m(M(Z,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,r.value]])],8,Ce),s("button",{ref_key:"resetvPassword",ref:F,type:"button",class:"hidden",onClick:e[12]||(e[12]=t=>a(d).$reset())}," reset ",512)],40,he))])],64)}}};export{Se as default};
