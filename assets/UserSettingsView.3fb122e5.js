var X=Object.defineProperty;var L=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var E=(b,l,t)=>l in b?X(b,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[l]=t,U=(b,l)=>{for(var t in l||(l={}))Y.call(l,t)&&E(b,t,l[t]);if(L)for(var t of L(l))ee.call(l,t)&&E(b,t,l[t]);return b};import{m as se,r as h,L as M,p as j,h as ae,a as p,c as w,b as N,d as s,n as R,M as $,F as T,q as a,f as D,s as I,w as i,v as x,j as k,k as P,x as z,T as S,y as Z,N as G}from"./index.a21a5dcc.js";import{_ as re}from"./CardTitle.e99c3c1c.js";import{c as v,r as V,m as te,a as oe,s as le,u as H}from"./index.esm.5949f234.js";const ne={class:"flex flex-wrap pl-6 text-center text-sm font-medium"},de={class:"flex flex-col items-center rounded-xl border-2 border-black bg-white p-8 shadow-post"},ie=["value"],ue={key:0,class:"mb-4 text-alert"},me=["onSubmit"],ce={class:"mb-1"},pe=s("label",{for:"nickName",class:"mb-1 block"},"\u66B1\u7A31",-1),be={key:0,class:"font-azeret text-alert"},fe={class:"mt-4 mb-8"},ve=s("label",{for:"male",class:"mb-1 block"},"\u6027\u5225",-1),we=s("label",{for:"male",class:"mr-7"},"\u7537\u6027",-1),ge=s("label",{for:"female",class:"mr-7"},"\u5973\u6027",-1),he=s("label",{for:"others",class:""},"\u4E0D\u516C\u958B",-1),ke=["disabled"],ye=["onSubmit"],xe={class:"mb-1"},_e=s("label",{for:"newPassword",class:"mb-1 block"},"\u8F38\u5165\u65B0\u5BC6\u78BC",-1),$e={key:0,class:"font-azeret text-alert"},Pe={class:"mb-1"},Ce=s("label",{for:"checkPassword",class:"mb-1 block"},"\u518D\u6B21\u8F38\u5165",-1),Ue={key:1,class:"font-azeret text-alert"},Me=["disabled"],Be={setup(b){const l=se(),t=h(!1),u=M({profile:"\u9001\u51FA\u66F4\u65B0",password:"\u91CD\u8A2D\u5BC6\u78BC"}),J=j(()=>({name:{required:v.withMessage("\u66B1\u7A31\u5FC5\u586B",V),minLength:v.withMessage("\u66B1\u7A31\u81F3\u5C11 2 \u500B\u5B57\u5143\u4EE5\u4E0A",te(2)),maxLength:v.withMessage("\u66B1\u7A31\u4E0D\u80FD\u9AD8\u65BC 10 \u500B\u5B57\u5143",oe(10))}})),K=j(()=>({password:{required:v.withMessage("\u5BC6\u78BC\u5FC5\u586B",V),alphaNum:v.withMessage("\u5BC6\u78BC\u9700\u81F3\u5C11 8 \u78BC\u4EE5\u4E0A\uFF0C\u4E26\u82F1\u6578\u6DF7\u5408",v.regex(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,/\d/))},passwordConfirm:{required:v.withMessage("\u5BC6\u78BC\u5FC5\u586B",V),sameAsPassword:v.withMessage("\u5BC6\u78BC\u4E0D\u4E00\u81F4",le(m.password))}})),_=h("editNickName"),B=c=>{_.value=c},o=h(U({},l.user));ae(l,c=>{o.value=U({},c.user)}),o.value.gender===void 0&&(o.value.gender="other");const y=H(J,o),C=h(null),F=h(null),n=M({base64:"",errorMessage:{size:"\u6A94\u6848\u9700\u5728 2 MB \u4EE5\u5167"},hasError:!1}),O=()=>{const c=C.value.files[0],e=new FormData;t.value=!0,e.append("avatar",c),e.append("name",o.value.name.trim()),e.append("gender",o.value.gender),G.updateProfile(e).then(f=>{f.data.status?(t.value=!1,u.profile="\u66F4\u65B0\u5B8C\u6210",l.updateUser(f.data.data),q(),g()):(t.value=!1,u.profile="\u66F4\u65B0\u5931\u6557",g())}).catch(()=>{t.value=!1,u.profile="\u66F4\u65B0\u5931\u6557",g()})},Q=c=>{const e=c.target.files[0];if(e.size>=2*1024*1024)return n.hasError=!0;const f=new FileReader;f.readAsDataURL(e),f.onload=r=>{n.hasError=!1,n.base64=r.target.result}},q=()=>{F.value.reset(),n.base64="",n.hasError=!1},m=M({}),d=H(K,m),A=h(null),W=async c=>{t.value=!0,await G.updatePassword(m).then(e=>{e.data.status?(t.value=!1,u.password="\u66F4\u65B0\u5B8C\u6210",m.password="",m.passwordConfirm="",g()):(t.value=!1,u.password="\u66F4\u65B0\u5931\u6557",g())}).catch(()=>{t.value=!1,u.password="\u66F4\u65B0\u5931\u6557",g()}),c.target.reset(),A.value.click()},g=()=>{setTimeout(()=>{u.profile="\u9001\u51FA\u66F4\u65B0",u.password="\u91CD\u8A2D\u5BC6\u78BC"},3e3)};return(c,e)=>{var f;return p(),w(T,null,[N(re,{title:"\u4FEE\u6539\u500B\u4EBA\u8CC7\u6599"}),s("ul",ne,[s("li",null,[s("a",{href:"#",class:R(["inline-block rounded-t-md border-x-2 border-t-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",_.value==="editNickName"?"bg-black text-white":""]),onClick:e[0]||(e[0]=$(r=>B("editNickName"),["prevent"]))}," \u66B1\u7A31\u4FEE\u6539 ",2)]),s("li",null,[s("a",{href:"#",class:R(["inline-block rounded-t-md border-t-2 border-r-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",_.value==="resetPassword"?"bg-black text-white":""]),onClick:e[1]||(e[1]=$(r=>B("resetPassword"),["prevent"]))}," \u91CD\u8A2D\u5BC6\u78BC ",2)])]),s("div",de,[_.value==="editNickName"?(p(),w(T,{key:0},[a(n).base64?(p(),D(I,{key:0,size:"107",imgUrl:a(n).base64,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])):(p(),D(I,{key:1,size:"107",imgUrl:(f=o.value)==null?void 0:f.avatar,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])),s("form",{ref_key:"avatarForm",ref:F,action:"",class:"text-center"},[s("input",{ref_key:"imageFile",ref:C,type:"file",name:"photos",accept:"image/png, image/jpeg, image/jpg",class:"btn btn-dark mb-4 hidden px-8 py-1",onChange:e[2]||(e[2]=r=>Q(r))},null,544),i(s("input",{type:"reset",value:"\u53D6\u6D88",class:"mb-4 mr-4 cursor-pointer rounded border border-black bg-white px-10 py-1 text-black",onClick:q},null,512),[[x,a(n).base64]]),s("input",{type:"button",value:a(n).base64===""?"\u4E0A\u50B3\u5927\u982D\u7167":"\u518D\u9078\u4E00\u5F35",class:"mb-4 cursor-pointer rounded border border-black bg-black px-6 py-1 text-white",onClick:e[3]||(e[3]=r=>C.value.click())},null,8,ie),a(n).hasError?(p(),w("p",ue," Tip: "+k(a(n).errorMessage.size),1)):P("",!0)],512),s("form",{onSubmit:$(O,["prevent"]),action:"",class:""},[s("div",ce,[pe,i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.name=r),type:"text",name:"",id:"nickName",placeholder:"\u8ACB\u8F38\u5165\u66B1\u7A31",class:"w-full border-2 border-black",onBlur:e[5]||(e[5]=(...r)=>a(y).name.$touch&&a(y).name.$touch(...r))},null,544),[[z,o.value.name]])]),a(y).name.$errors.length>0?(p(),w("div",be,k(a(y).name.$errors[0].$message),1)):P("",!0),s("div",fe,[ve,i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.value.gender=r),type:"radio",name:"gender",id:"male",value:"male",class:"mr-3"},null,512),[[S,o.value.gender]]),we,i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.value.gender=r),type:"radio",name:"gender",id:"female",value:"female",class:"mr-3"},null,512),[[S,o.value.gender]]),ge,i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.value.gender=r),type:"radio",name:"gender",id:"others",value:"others",class:"mr-3"},null,512),[[S,o.value.gender]]),he]),s("button",{type:"submit",class:"flex w-full items-center justify-center rounded border-2 border-black bg-warning py-4 text-black disabled:opacity-50",disabled:a(y).name.$errors.length>0},[i(s("span",null,k(a(u).profile),513),[[x,!t.value]]),i(N(Z,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,t.value]])],8,ke)],40,me)],64)):(p(),w("form",{key:1,onSubmit:$(W,["prevent"]),action:"",class:"flex-col items-center"},[s("div",xe,[_e,i(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>a(m).password=r),type:"password",id:"newPassword",placeholder:"\u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",onBlur:e[10]||(e[10]=(...r)=>a(d).password.$touch&&a(d).password.$touch(...r)),required:""},null,544),[[z,a(m).password]])]),a(d).password.$errors.length>0?(p(),w("div",$e,k(a(d).password.$errors[0].$message),1)):P("",!0),s("div",Pe,[Ce,i(s("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>a(m).passwordConfirm=r),type:"password",id:"checkPassword",placeholder:"\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",onBlur:e[12]||(e[12]=(...r)=>a(d).passwordConfirm.$touch&&a(d).passwordConfirm.$touch(...r)),required:""},null,544),[[z,a(m).passwordConfirm]])]),a(d).passwordConfirm.$errors.length>0?(p(),w("div",Ue,k(a(d).passwordConfirm.$errors[0].$message),1)):P("",!0),s("button",{type:"submit",class:"mt-8 flex w-full items-center justify-center rounded border-2 border-black bg-subtitle py-4 text-black disabled:opacity-50",disabled:a(d).password.$errors.length>0||a(d).passwordConfirm.$errors.length>0||a(m).password===void 0},[i(s("span",null,k(a(u).password),513),[[x,!t.value]]),i(N(Z,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,t.value]])],8,Me),s("button",{ref_key:"resetvPassword",ref:A,type:"button",class:"hidden",onClick:e[13]||(e[13]=r=>a(d).$reset())}," reset ",512)],40,ye))])],64)}}};export{Be as default};
